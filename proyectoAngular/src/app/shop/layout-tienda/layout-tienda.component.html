<div id="carrito_wrapper">
    <img src="../../../assets/icono-ventas.png" id="icono_carrito" alt="icono_carrito">
</div>

<div id="grid_principal" [ngClass]="getScreenSize()">
    <section id="tienda_grid">
        <!-- portada -->
        <div id="portada">
            <h3> Tienda Virtual</h3>
        </div>
        <!-- buscador -->
        <form id="barra_buscador">
            <label for="search" id="titulo_buscador">Busca lo que deseas!</label> <br>
            <div id="input_wrapper">
                <input type="text" id="buscar" name="buscar" placeholder="buscar..." [(ngModel)] = "palabraBusqueda" (keydown)="buscarProducto()">
                <button type="button" id="ok_buscar" (click)="buscarProducto()">OK</button>
            </div>
        </form>      
        <!-- productos -->
        <div id="grid_productos">
            <div class="productos" *ngFor="let product of products" id="{{product.name}}" [ngStyle]="{'display' : product.display}">
                <!-- imagen presentacion -->
                <div class="img_wrapper">
                    <img src="{{ product.image }}" alt="img_producto" class="icono_producto">
                </div>
                <!-- info producto -->
                <div class="detalles_producto">
                    <h4 class="titulo_producto"> {{ product.name }} </h4>
                    <ul class="carac_producto">
                        <li class="precios">Precio: $<b>{{product.precio}}</b></li>
                        <li class="categ_producto">Categoria: {{ product.category }} </li>
                        <li class="stock_producto">Stock: {{ product.stock }}</li>
                        <li class="descripcion_producto">Descripción: {{ product.description}} </li>
                    </ul>
                </div>
                <!-- boton de compra -->
                <div class="boton_wrapper">
                    <button type="button" class="boton_carrito" (click)="comprarProducto($event)"> Comprar</button>
                </div>
            </div>
        </div>
        <!-- ventana modal (compra)-->
        <div class="lightbox" *ngIf="abrirModal" [ngClass]="getScreenSize()">
            <div class="cuadro_compra">
                <!-- cerrar -->
                <div class="barra_cerrar">
                    <img src="../../../assets/icono-cerrar.png" alt="cerrar" (click)="cerrarModalCompra()">
                </div>
                <!-- logo -->
                <div class="logo_producto">
                    <!-- imagen dinamica -->
                    <img [src]="imagenProdSeleccionado">
                </div>
                <!-- formulario (añadir al carrito)-->
                <form class="formulario">
                    <h3>{{nombreProdSeleccionado}}</h3>
                    <div id="cantidad_wrapper">
                        <label for="cantidad">Cantidad: </label>
                        <input type="number" name="cantidad" min="1" id="field_cantidad" [disabled]="limiteStock" [(ngModel)] = "cantidadElegida">
                        <br><hr>
                    </div>
                    <ul class="detalles_formulario">
                        <li id="precio_unitario">Precio unitario: <b>${{valorUnitario}}</b> </li>
                        <li id="cantidad_elegida">Cantidad Elegida: <b>{{cantidadElegida}}</b> </li>
                        <li id="valor_comprado">Valor compra: <b>${{valorUnitario * cantidadElegida}}</b> </li>
                        <p *ngIf="validarCantidad()"> <b>LLEGASTE AL LIMITE DEL STOCK</b> </p>
                        <br><hr>
                    </ul>
                    <p *ngIf="cantidadElegida == 0" [ngClass]="{'shakeElement': remarcarMensajeCantidad}">
                        <b>DEBES SELECCIONAR AL MENOS 1 UNIDAD!</b>
                    </p>
                    <!-- botones -->
                    <div class="button_wrapper">
                        <button type="submit" id="anadir_carrito" class="botones_form">Añadir al carrito</button><br>
                        <button type="submit" id="terminar_compra" class="botones_form" (click)="abrirMetodosPago(cantidadElegida)">Ir a la caja</button><br>
                    </div>
                </form>
            </div>
        </div>
        <!-- ventana modal (formas de pago)-->
        <div class="lightbox" *ngIf="abirFormasPago" [ngClass]="getScreenSize()">
            <div class="cuadro_compra" id="formas_pago_form">
                <!-- cerrar -->
                <div class="barra_cerrar">
                    <img src="../../../assets/icono-cerrar.png" alt="cerrar" (click)="cerrarMetodosPago()">
                </div>
                <!-- logo -->
                <div class="logo_producto">
                    <img src="../../../assets/isologo.png" alt="logo-pagina" class="isologo_modales">
                </div>
                <!-- formulario (formas de pago)-->
                <form class="formulario" [formGroup]="cajaValidacion" (ngSubmit)="onSubmit()">
                    <div class="detalles_formulario" id="detalles_pago">

                        <!-- seleccionar forma de pago -->
                        <label for="opciones_pago"><b>Selecciona una forma de pago:</b></label> <br>
                        <select id="opciones_pago" name="pagos" formControlName="medioPagoSeleccionado">
                            <option value="tajeta_credito_debito">Tarjeta Credito / debito</option>
                            <option value="transferencia"> Transferencia bancaria</option>
                            <option value="billetera_virtual">Billetera virtual</option>
                        </select>
                        <hr>

                        <!-- tarjeta credito o debito-->
                        <div id="tarjeta_credito" *ngIf="cajaValidacion.get('medioPagoSeleccionado')!.value === 'tajeta_credito_debito'">
                            <!-- numero tarjeta -->
                            <label for="tarjeta"><b>Número de tarjeta de credito / debito: </b></label> <br>
                            <img [src]="cambiarIconoSrc(cajaValidacion.controls['InputNumeroTarjeta'], numeroTarjetaRegex)" class="icono_validacion">
                            <input type="number" name="tarjeta" formControlName="InputNumeroTarjeta"> <br>
                            <p class="mensaje_error" *ngIf="mostrarError(cajaValidacion.controls['InputNumeroTarjeta'])">numero invalido!</p>
                            <!-- codigo seguridad -->
                            <label for="codigo"> <b>Introduce el código de seguridad de la tarjeta:</b> </label> <br>
                            <img [src]="cambiarIconoSrc(cajaValidacion.controls['InputCodSegTarjeta'], codigoSeguridadRegex)" class="icono_validacion">
                            <input type="number" name="codigo" formControlName="InputCodSegTarjeta">
                            <img src="../../../assets/imagenes-tienda/card-sample.png" class="icono_tarjeta" (click)="modalCodigo()"> <br>
                            <p class="mensaje_error" *ngIf="mostrarError(cajaValidacion.controls['InputCodSegTarjeta'])">solo debe contener 3 numeros!</p>
                            <!-- fecha expiración -->
                            <label for="expiracion"><b>Selecciona la fecha de expiración:</b></label> <br>
                            <img [src]="cambiarIconoSrc(cajaValidacion.controls['InputExpTarjeta'], expiracionRegex)" class="icono_validacion">
                            <input type="month" name="expiracion" formControlName="InputExpTarjeta">
                            <img src="../../../assets/imagenes-tienda/card-sample.png" class="icono_tarjeta" (click)="modalExpiracion()"> <br> 
                            <hr>
                        </div>
                        <!-- transferencia -->
                        <div id="transferencia" *ngIf="cajaValidacion.get('medioPagoSeleccionado')!.value === 'transferencia'">
                            <h6>Datos de nuestra cuenta bancaria:</h6>
                            <ul>
                                <li><b>CBU:</b> 123123123123121</li>
                                <li><b>ALIAS:</b> gardening.friend</li>
                                <li><b>BANCO:</b> Santander</li>
                            </ul>
                            <p> Una vez que realices tu pago envia el comprobante a nuestro mail <i>gardeningfriend@gmail.com</i> 
                                para poder validarlo</p>
                            <hr>
                        </div>
                        <!-- billetera virtual-->
                        <div id="billetera" *ngIf="cajaValidacion.get('medioPagoSeleccionado')!.value === 'billetera_virtual'">
                            <!-- numero tarjeta -->
                            <label for="tarjeta_billetera"><b>Número de tarjeta de credito / debito: </b></label> <br>
                            <img [src]="" class="icono_validacion">
                            <input type="number" name="tarjeta_billetera" formControlName=""> <br>
                            <p class="mensaje_error" *ngIf="">numero invalido!</p>
                            <!-- codigo seguridad -->
                            <label for="codigo_billetera"> <b>Introduce el código de seguridad de la tarjeta:</b> </label> <br>
                            <img [src]="" class="icono_validacion">
                            <input type="number" name="codigo_billetera" formControlName="">
                            <img src="../../../assets/imagenes-tienda/card-sample.png" class="icono_tarjeta" (click)="modalCodigo()"> <br>
                            <p class="mensaje_error" *ngIf="">solo debe contener 3 numeros!</p>
                            <!-- fecha expiración -->
                            <label for="expiracion_billetera"><b>Selecciona la fecha de expiración:</b></label> <br>
                            <img [src]="" class="icono_validacion">
                            <input type="month" name="expiracion_billetera" formControlName="">
                            <img src="../../../assets/imagenes-tienda/card-sample.png" class="icono_tarjeta" (click)="modalExpiracion()"> <br> 
                            <hr>
                        </div>

                        <!-- ingresa tu direccion -->
                        <div id="info_direccion">
                            <label for="direccion"><b>Ingresa tu dirección:</b> {{cajaValidacion.controls['InputDireccion'].value}}</label><br>
                            <img [src]="cambiarIconoSrc(cajaValidacion.controls['InputDireccion'], direccionRegex)" class="icono_validacion">
                            <input type="text" name="direccion" formControlName="InputDireccion"><br>
                            <p class="mensaje_error" *ngIf="mostrarError(cajaValidacion.controls['InputDireccion'])">solo se permiten caracteres alfanumericos!</p>
                            
                            <label for="provincia" ><b> Provincia:</b> {{cajaValidacion.controls['InputProvincia'].value}} </label> <br>
                            <img [src]="cambiarIconoSrc(cajaValidacion.controls['InputProvincia'], provinciaRegex)" class="icono_validacion">
                            <input type="text" name="provincia" formControlName="InputProvincia"> <br>
                            <p class="mensaje_error" *ngIf="mostrarError(cajaValidacion.controls['InputProvincia'])">no se permiten numeros ni carac. especiales!</p>
                            
                            <label for="ciudad"><b> Localidad: </b> {{cajaValidacion.controls['InputLocalidad'].value}} </label> <br>
                            <img [src]="cambiarIconoSrc(cajaValidacion.controls['InputLocalidad'], localidadRegex)" class="icono_validacion">
                            <input type="text" name="ciudad" formControlName="InputLocalidad"> <br>
                            <p class="mensaje_error" *ngIf="mostrarError(cajaValidacion.controls['InputLocalidad'])">no se permiten numeros ni carac. especiales! </p>
                            <hr>
                        </div>

                        <!-- costos -->
                        <div id="detalles_costos">
                            <p style="margin-bottom: 7px;"><b>Detalles Compra:</b></p>
                            <p>Producto elegido: <b>{{nombreProdSeleccionado}}</b></p>
                            <p>Costo compra: <b>${{costoCompra}}</b></p>
                            <p>Costo envio: <b>{{calcularEnvio(cajaValidacion.controls['InputDireccion'], cajaValidacion.controls['InputProvincia'], cajaValidacion.controls['InputLocalidad'] )}}</b></p>
                            <hr>
                            <p style="font-size: 1.1rem; margin-top: 10px;"><b>Total: ${{sumarCostosFinales()}} </b></p>
                        </div>
                    </div>
                    <!-- botones -->
                    <div class="button_wrapper">
                        <button type="submit" id="Finalizar" class="botones_form" [disabled]="!cajaValidacion.valid">Finalizar Compra</button><br>
                    </div>
                </form>
            </div>
        </div>
        <!-- ejemplo modal (codigo seguridad)-->
        <div class="lightbox" *ngIf="mostrarEjemploCodigo" [ngClass]="getScreenSize()">
            <div class="modal_ejemplo">
                <div class="barra_cerrar_modal">
                    <img src="../../../assets/icono-cerrar.png" id="cerrar_modal_1" (click)="modalCodigo()">
                </div>
                <img src="../../../assets/imagenes-tienda/image-card-sample-1.png" alt="ejemplo">
            </div>
        </div>
        <!-- ejemplo modal (fecha expiracion)-->
        <div class="lightbox" *ngIf="mostrarEjemploExpiracion" [ngClass]="getScreenSize()">
            <div class="modal_ejemplo">
                <div class="barra_cerrar_modal">
                    <img src="../../../assets/icono-cerrar.png" id="cerrar_modal_1" (click)="modalExpiracion()">
                </div>
                <img src="../../../assets/imagenes-tienda/image-card-sample-2.png" alt="ejemplo">
            </div>
        </div>
        <!-- modal - compra realizada con exito! -->
        <div class="lightbox" *ngIf="compraRealizada" [ngClass]="getScreenSize()">
            <div class="finalizar_compra">
                <div class="cerrar_modal_final">
                    <img src="../../../assets/icono-cerrar.png" alt="cerrar" (click)="cerrarValidarCompra()">
                </div>
                <div class="contenido_modal_final">
                    <img src="../../../assets/imagenes-tienda/delivery-icon.gif" alt="delivery">
                    <div class="titulo">
                        <img src="../../../assets/imagenes-tienda/done-icon.png" id="done_icon" alt="done">
                        <h3>Compra realizada con exito</h3>
                    </div>
                    <p>Ya estamos gestionando el envío, via mail recibiras las notificaciones relacioandas
                        al mismo. La factura será enviada por mail también.
                    </p>
                </div>
            </div>
        </div>

    </section>
</div>
